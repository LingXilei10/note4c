## è‡ªå·±

```cpp
class Solution {
public:
    int trap(vector<int>& height) {
        int ans=0;
        vector<int> si(height.size(),0),ei(height.size(),0);
        for(int i=0;i<height.size();i++){
            si[i]=i? max(si[i-1],height[i-1]):0;
        }  // iä¹‹å‰æœ€å¤§çš„æ•°
        for(int i=height.size()-1;i>=0;i--){
            ei[i]=i<height.size()-1? max(ei[i+1],height[i+1]):0;
        }  // iä¹‹åæœ€å¤§çš„æ•°
        for(int i=0;i<height.size();i++){
            ans +=  max(min(si[i],ei[i])-height[i],0);
        }
        return ans;
    }
};
// ä»¥ä¸‹çš„è§£æ³•ä¸­æ— éœ€ä¸height[i-1]æ¯”ï¼Œç›´æ¥height[i]ã€‚
// é‚£ä¹ˆä¹‹åä¹Ÿåªéœ€è¦min(l_max[i], r_max[i]) - height[i] 
// è€Œæ— éœ€åˆ¤æ–­ä¸¤è¾¹æœ€å¤§å€¼æ˜¯å¦æ¯”è‡ªå·±å¤§äº†ï¼ï¼ï¼
```



## langbuladong

å¯¹äºä»»æ„ä¸€ä¸ªä½ç½® `i`ï¼Œèƒ½å¤Ÿè£…çš„æ°´ä¸ºï¼š

```python
water[i] = min(
           # å·¦è¾¹æœ€é«˜çš„æŸ±å­
           max(height[0..i]),
           # å³è¾¹æœ€é«˜çš„æŸ±å­
           max(height[i..end])
        ) - height[i]
```



![img](E:\076lxl\work\note4c\leetcode\assets\1.jpg)



**å…³é”®åœ¨äºï¼Œå¦‚ä½•èƒ½å¤Ÿå¿«é€Ÿè®¡ç®—å‡ºæŸä¸€ä¸ªä½ç½®å·¦ä¾§æ‰€æœ‰æŸ±å­çš„æœ€å¤§é«˜åº¦å’Œå³ä¾§æ‰€æœ‰æŸ±å­çš„æœ€å¤§é«˜åº¦**ã€‚

è¿™é“é¢˜çš„è§£æ³•æ¯”è¾ƒå¤šæ ·ï¼Œå¯ä»¥é¢„è®¡ç®—æ•°ç»„ï¼Œå¯ä»¥ç”¨ [åŒæŒ‡æŠ€å·§](https://labuladong.online/algo/essential-technique/array-two-pointers-summary/)ï¼Œå¯ä»¥ç”¨[å•è°ƒæ ˆæŠ€å·§](https://labuladong.online/algo/data-structure/monotonic-stack/)ï¼Œè¿™é‡Œå°±è¯´ä¸€ä¸ªæœ€ç®€å•çš„è§£æ³•ï¼Œç”¨é¢„è®¡ç®—çš„æ–¹å¼æ±‚è§£ï¼Œä¼˜åŒ–æš´åŠ›è§£æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ›´å¤šè§£æ³•è¯·çœ‹è¯¦ç»†é¢˜è§£ã€‚

**è¯¦ç»†é¢˜è§£**ï¼š

- [å¦‚ä½•é«˜æ•ˆè§£å†³æ¥é›¨æ°´é—®é¢˜](https://labuladong.online/algo/frequency-interview/trapping-rain-water/)

## è§£æ³•ä»£ç 

```cpp
// æ³¨æ„ï¼šcpp ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ã€‚
// æœ¬ä»£ç çš„æ­£ç¡®æ€§å·²é€šè¿‡åŠ›æ‰£éªŒè¯ï¼Œå¦‚æœ‰ç–‘é—®ï¼Œå¯ä»¥å¯¹ç…§ java ä»£ç æŸ¥çœ‹ã€‚

#include <vector>
#include <algorithm>

class Solution {
public:
    int trap(std::vector<int>& height) {
        if (height.empty()) {
            return 0;
        }
        int n = height.size();
        int res = 0;
        // æ•°ç»„å……å½“å¤‡å¿˜å½•
        std::vector<int> l_max(n);
        std::vector<int> r_max(n);
        // åˆå§‹åŒ– base case
        l_max[0] = height[0];
        r_max[n - 1] = height[n - 1];
        // ä»å·¦å‘å³è®¡ç®— l_max
        for (int i = 1; i < n; i++)
            l_max[i] = std::max(height[i], l_max[i - 1]);   
        // ä»å³å‘å·¦è®¡ç®— r_max
        for (int i = n - 2; i >= 0; i--)
            r_max[i] = std::max(height[i], r_max[i + 1]);
        // è®¡ç®—ç­”æ¡ˆ
        for (int i = 1; i < n - 1; i++)
            res += std::min(l_max[i], r_max[i]) - height[i];
        return res;
    }
};
```

## å®˜æ–¹é¢˜è§£

### æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’

å¯¹äºä¸‹æ ‡ iï¼Œä¸‹é›¨åæ°´èƒ½åˆ°è¾¾çš„æœ€å¤§é«˜åº¦ç­‰äºä¸‹æ ‡ i ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦çš„æœ€å°å€¼ï¼Œä¸‹æ ‡ i å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äºä¸‹æ ‡ i å¤„çš„æ°´èƒ½åˆ°è¾¾çš„æœ€å¤§é«˜åº¦å‡å» height[i]ã€‚

æœ´ç´ çš„åšæ³•æ˜¯å¯¹äºæ•°ç»„ height ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«å‘å·¦å’Œå‘å³æ‰«æå¹¶è®°å½•å·¦è¾¹å’Œå³è¾¹çš„æœ€å¤§é«˜åº¦ï¼Œç„¶åè®¡ç®—æ¯ä¸ªä¸‹æ ‡ä½ç½®èƒ½æ¥çš„é›¨æ°´é‡ã€‚å‡è®¾æ•°ç»„ height çš„é•¿åº¦ä¸º nï¼Œè¯¥åšæ³•éœ€è¦å¯¹æ¯ä¸ªä¸‹æ ‡ä½ç½®ä½¿ç”¨ O(n) çš„æ—¶é—´å‘ä¸¤è¾¹æ‰«æå¹¶å¾—åˆ°æœ€å¤§é«˜åº¦ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦æ˜¯ O(n 
2
 )ã€‚

ä¸Šè¿°åšæ³•çš„æ—¶é—´å¤æ‚åº¦è¾ƒé«˜æ˜¯å› ä¸ºéœ€è¦å¯¹æ¯ä¸ªä¸‹æ ‡ä½ç½®éƒ½å‘ä¸¤è¾¹æ‰«æã€‚å¦‚æœå·²ç»çŸ¥é“æ¯ä¸ªä½ç½®ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦ï¼Œåˆ™å¯ä»¥åœ¨ O(n) çš„æ—¶é—´å†…å¾—åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ O(n) çš„æ—¶é—´å†…é¢„å¤„ç†å¾—åˆ°æ¯ä¸ªä½ç½®ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦ã€‚

åˆ›å»ºä¸¤ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ leftMax å’Œ rightMaxã€‚å¯¹äº 0â‰¤i<nï¼ŒleftMax[i] è¡¨ç¤ºä¸‹æ ‡ i åŠå…¶å·¦è¾¹çš„ä½ç½®ä¸­ï¼Œheight çš„æœ€å¤§é«˜åº¦ï¼ŒrightMax[i] è¡¨ç¤ºä¸‹æ ‡ i åŠå…¶å³è¾¹çš„ä½ç½®ä¸­ï¼Œheight çš„æœ€å¤§é«˜åº¦ã€‚

æ˜¾ç„¶ï¼ŒleftMax[0]=height[0]ï¼ŒrightMax[nâˆ’1]=height[nâˆ’1]ã€‚ä¸¤ä¸ªæ•°ç»„çš„å…¶ä½™å…ƒç´ çš„è®¡ç®—å¦‚ä¸‹ï¼š

å½“ 1â‰¤iâ‰¤nâˆ’1 æ—¶ï¼ŒleftMax[i]=max(leftMax[iâˆ’1],height[i])ï¼›

å½“ 0â‰¤iâ‰¤nâˆ’2 æ—¶ï¼ŒrightMax[i]=max(rightMax[i+1],height[i])ã€‚

å› æ­¤å¯ä»¥æ­£å‘éå†æ•°ç»„ height å¾—åˆ°æ•°ç»„ leftMax çš„æ¯ä¸ªå…ƒç´ å€¼ï¼Œåå‘éå†æ•°ç»„ height å¾—åˆ°æ•°ç»„ rightMax çš„æ¯ä¸ªå…ƒç´ å€¼ã€‚

åœ¨å¾—åˆ°æ•°ç»„ leftMax å’Œ rightMax çš„æ¯ä¸ªå…ƒç´ å€¼ä¹‹åï¼Œå¯¹äº 0â‰¤i<nï¼Œä¸‹æ ‡ i å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äº min(leftMax[i],rightMax[i])âˆ’height[i]ã€‚éå†æ¯ä¸ªä¸‹æ ‡ä½ç½®å³å¯å¾—åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚

åŠ¨æ€è§„åˆ’åšæ³•å¯ä»¥ç”±ä¸‹å›¾ä½“ç°ã€‚

```cpp
class Solution {
public:
    int trap(vector<int>& height) {
        int n = height.size();
        if (n == 0) {
            return 0;
        }
        vector<int> leftMax(n);
        leftMax[0] = height[0];
        for (int i = 1; i < n; ++i) {
            leftMax[i] = max(leftMax[i - 1], height[i]);
        }

        vector<int> rightMax(n);
        rightMax[n - 1] = height[n - 1];
        for (int i = n - 2; i >= 0; --i) {
            rightMax[i] = max(rightMax[i + 1], height[i]);
        }

        int ans = 0;
        for (int i = 0; i < n; ++i) {
            ans += min(leftMax[i], rightMax[i]) - height[i];
        }
        return ans;
    }
};
```

#### å¤æ‚åº¦åˆ†æ

æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ height çš„é•¿åº¦ã€‚è®¡ç®—æ•°ç»„ leftMax å’Œ rightMax çš„å…ƒç´ å€¼å„éœ€è¦éå†æ•°ç»„ height ä¸€æ¬¡ï¼Œè®¡ç®—èƒ½æ¥çš„é›¨æ°´æ€»é‡è¿˜éœ€è¦éå†ä¸€æ¬¡ã€‚

ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ height çš„é•¿åº¦ã€‚éœ€è¦åˆ›å»ºä¸¤ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ leftMax å’Œ rightMaxã€‚



### æ–¹æ³•äºŒï¼šå•è°ƒæ ˆ

é™¤äº†è®¡ç®—å¹¶å­˜å‚¨æ¯ä¸ªä½ç½®ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨å•è°ƒæ ˆè®¡ç®—èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚

ç»´æŠ¤ä¸€ä¸ªå•è°ƒæ ˆï¼Œå•è°ƒæ ˆå­˜å‚¨çš„æ˜¯ä¸‹æ ‡ï¼Œæ»¡è¶³ä»æ ˆåº•åˆ°æ ˆé¡¶çš„ä¸‹æ ‡å¯¹åº”çš„æ•°ç»„ height ä¸­çš„å…ƒç´ é€’å‡ã€‚

ä»å·¦åˆ°å³éå†æ•°ç»„ï¼Œéå†åˆ°ä¸‹æ ‡ i æ—¶ï¼Œå¦‚æœæ ˆå†…è‡³å°‘æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œè®°æ ˆé¡¶å…ƒç´ ä¸º topï¼Œtop çš„ä¸‹é¢ä¸€ä¸ªå…ƒç´ æ˜¯ leftï¼Œåˆ™ä¸€å®šæœ‰ height[left]â‰¥height[top]ã€‚å¦‚æœ height[i]>height[top]ï¼Œåˆ™å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ¥é›¨æ°´çš„åŒºåŸŸï¼Œè¯¥åŒºåŸŸçš„å®½åº¦æ˜¯ iâˆ’leftâˆ’1ï¼Œé«˜åº¦æ˜¯ min(height[left],height[i])âˆ’height[top]ï¼Œæ ¹æ®å®½åº¦å’Œé«˜åº¦å³å¯è®¡ç®—å¾—åˆ°è¯¥åŒºåŸŸèƒ½æ¥çš„é›¨æ°´é‡ã€‚

ä¸ºäº†å¾—åˆ° leftï¼Œéœ€è¦å°† top å‡ºæ ˆã€‚åœ¨å¯¹ top è®¡ç®—èƒ½æ¥çš„é›¨æ°´é‡ä¹‹åï¼Œleft å˜æˆæ–°çš„ topï¼Œé‡å¤ä¸Šè¿°æ“ä½œï¼Œç›´åˆ°æ ˆå˜ä¸ºç©ºï¼Œæˆ–è€…æ ˆé¡¶ä¸‹æ ‡å¯¹åº”çš„ height ä¸­çš„å…ƒç´ å¤§äºæˆ–ç­‰äº height[i]ã€‚

åœ¨å¯¹ä¸‹æ ‡ i å¤„è®¡ç®—èƒ½æ¥çš„é›¨æ°´é‡ä¹‹åï¼Œå°† i å…¥æ ˆï¼Œç»§ç»­éå†åé¢çš„ä¸‹æ ‡ï¼Œè®¡ç®—èƒ½æ¥çš„é›¨æ°´é‡ã€‚éå†ç»“æŸä¹‹åå³å¯å¾—åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚

ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­ height=[0,1,0,2,1,0,1,3,2,1,2,1] æ¥å¸®åŠ©è¯»è€…ç†è§£å•è°ƒæ ˆçš„åšæ³•ã€‚

```cpp
class Solution {
public:
    int trap(vector<int>& height) {
        int ans = 0;
        stack<int> stk;
        int n = height.size();
        for (int i = 0; i < n; ++i) {
            while (!stk.empty() && height[i] > height[stk.top()]) {
                int top = stk.top();
                stk.pop();
                if (stk.empty()) {
                    break;
                }
                int left = stk.top();
                int currWidth = i - left - 1;
                int currHeight = min(height[left], height[i]) - height[top];
                ans += currWidth * currHeight;
            }
            stk.push(i);
        }
        return ans;
    }
};
```

#### å¤æ‚åº¦åˆ†æ

æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ height çš„é•¿åº¦ã€‚ä» 0 åˆ° nâˆ’1 çš„æ¯ä¸ªä¸‹æ ‡æœ€å¤šåªä¼šå…¥æ ˆå’Œå‡ºæ ˆå„ä¸€æ¬¡ã€‚

ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ height çš„é•¿åº¦ã€‚ç©ºé—´å¤æ‚åº¦ä¸»è¦å–å†³äºæ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ä¸ä¼šè¶…è¿‡ nã€‚

### æ–¹æ³•ä¸‰ï¼šåŒæŒ‡é’ˆ

åŠ¨æ€è§„åˆ’çš„åšæ³•ä¸­ï¼Œéœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ•°ç»„ leftMax å’Œ rightMaxï¼Œå› æ­¤ç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚æ˜¯å¦å¯ä»¥å°†ç©ºé—´å¤æ‚åº¦é™åˆ° O(1)ï¼Ÿ

æ³¨æ„åˆ°ä¸‹æ ‡ i å¤„èƒ½æ¥çš„é›¨æ°´é‡ç”± leftMax[i] å’Œ rightMax[i] ä¸­çš„æœ€å°å€¼å†³å®šã€‚ç”±äºæ•°ç»„ leftMax æ˜¯ä»å·¦å¾€å³è®¡ç®—ï¼Œæ•°ç»„ rightMax æ˜¯ä»å³å¾€å·¦è®¡ç®—ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆå’Œä¸¤ä¸ªå˜é‡ä»£æ›¿ä¸¤ä¸ªæ•°ç»„ã€‚

ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆ left å’Œ rightï¼Œä»¥åŠä¸¤ä¸ªå˜é‡ leftMax å’Œ rightMaxï¼Œåˆå§‹æ—¶ left=0,right=nâˆ’1,leftMax=0,rightMax=0ã€‚æŒ‡é’ˆ left åªä¼šå‘å³ç§»åŠ¨ï¼ŒæŒ‡é’ˆ right åªä¼šå‘å·¦ç§»åŠ¨ï¼Œåœ¨ç§»åŠ¨æŒ‡é’ˆçš„è¿‡ç¨‹ä¸­ç»´æŠ¤ä¸¤ä¸ªå˜é‡ leftMax å’Œ rightMax çš„å€¼ã€‚

å½“ä¸¤ä¸ªæŒ‡é’ˆæ²¡æœ‰ç›¸é‡æ—¶ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š

ä½¿ç”¨ height[left] å’Œ height[right] çš„å€¼æ›´æ–° leftMax å’Œ rightMax çš„å€¼ï¼›

å¦‚æœ height[left]<height[right]ï¼Œåˆ™å¿…æœ‰ leftMax<rightMaxï¼Œä¸‹æ ‡ left å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äº leftMaxâˆ’height[left]ï¼Œå°†ä¸‹æ ‡ left å¤„èƒ½æ¥çš„é›¨æ°´é‡åŠ åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ï¼Œç„¶åå°† left åŠ  1ï¼ˆå³å‘å³ç§»åŠ¨ä¸€ä½ï¼‰ï¼›

å¦‚æœ height[left]â‰¥height[right]ï¼Œåˆ™å¿…æœ‰ leftMaxâ‰¥rightMaxï¼Œä¸‹æ ‡ right å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äº rightMaxâˆ’height[right]ï¼Œå°†ä¸‹æ ‡ right å¤„èƒ½æ¥çš„é›¨æ°´é‡åŠ åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ï¼Œç„¶åå°† right å‡ 1ï¼ˆå³å‘å·¦ç§»åŠ¨ä¸€ä½ï¼‰ã€‚

å½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡æ—¶ï¼Œå³å¯å¾—åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ã€‚

ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­ height=[0,1,0,2,1,0,1,3,2,1,2,1] æ¥å¸®åŠ©è¯»è€…ç†è§£åŒæŒ‡é’ˆçš„åšæ³•ã€‚

```cpp
class Solution {
public:
    int trap(vector<int>& height) {
        int ans = 0;
        int left = 0, right = height.size() - 1;
        int leftMax = 0, rightMax = 0;
        while (left < right) {
            leftMax = max(leftMax, height[left]);
            rightMax = max(rightMax, height[right]);
            if (height[left] < height[right]) {
                ans += leftMax - height[left];
                ++left;
            } else {
                ans += rightMax - height[right];
                --right;
            }
        }
        return ans;
    }
};
```

#### å¤æ‚åº¦åˆ†æ

æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ height çš„é•¿åº¦ã€‚ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨æ€»æ¬¡æ•°ä¸è¶…è¿‡ nã€‚

ç©ºé—´å¤æ‚åº¦ï¼šO(1)ã€‚åªéœ€è¦ä½¿ç”¨å¸¸æ•°çš„é¢å¤–ç©ºé—´ã€‚

